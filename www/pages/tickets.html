<template>
    <div class="page" data-name="tickets">
        <div class="navbar">
            <div class="navbar-bg"></div>
            <div class="navbar-inner sliding color-white">
				<div class="left">
					<a href="#" class="link icon-only panel-open">
						<i class="f7-icons">line_horizontal_3</i>
					</a>
				</div>
                <div class="title">Tickets</div>
				<div class="right">
					<a href="#" class="link icon-only" @click="focusRange()">
						<i class="material-icons">filter_alt</i>
					</a>
				</div>
            </div>
        </div>
        <div class="page-content">
			
			<div style="height:0; overflow:hidden">
				<div class="block-title">Range Picker</div>
				<div class="list no-hairlines-md">
				  <ul>
					<li>
					  <div class="item-content item-input">
						<div class="item-inner">
						  <div class="item-input-wrap">
							<input type="text" placeholder="Select date range" readonly="readonly" id="demo-calendar-range"/>
						  </div>
						</div>
					  </div>
					</li>
				  </ul>
				</div>
			</div>
			
			<div class="list list-tickets" style="margin-top:0">
				<ul>
					{{#each tickets}}
					{{#if sep}}
					<li style="background-color: #DDD; padding:5px 15px;">
						{{date.toDateString()}}
					</li>
					{{else}}
					<li class="ripple">
						<a href="/ticket/" class="ripple">
							<div class="item-content ripple">
								<div class="item-media"><i class="f7-icons">doc_text</i></div>
								<div class="item-inner">
									<div class="item-title">{{name}}</div>
									<div class="item-after">{{hour}}</div>
								</div>
							</div>
						</a>
					</li>
					{{/if}}
                    {{/each}}
				</ul>
			</div>
			
        </div>
    </div>
</template>
<script>
    return {
		on: {
			// each object key means same name event handler
			pageInit: function (page) {
				// do something on page init
				var calendarRange = MyApp.fw7.app.calendar.create({
					inputEl: '#demo-calendar-range',
					rangePicker: true,
					on: {
						change: function(c, v) {
							if (v.length == 2) {
								console.log("GOT RANGE !");
								MyApp.fw7.app.preloader.show();
								setTimeout(function() {
									MyApp.fw7.app.preloader.hide();
									calendarRange.close();
								}, 400);
							}
						}
					}
				});
			},
			pageTabShow: function() {
				
			}
		},
		methods: {
			focusRange: function() {
				$$('#demo-calendar-range').trigger("click");
			},
			SetNullDate: function(d) {
				d.setHours(0);
				d.setMinutes(0);
				d.setSeconds(0);
				d.setMilliseconds(0);
				return d;
			},
			GetTickets: function(a) {
				a.sort(function(a, b) {
					return new Date(b.date.replace(' ', 'T')) - new Date(a.date.replace(' ', 'T'))
				});
				let b = [], d = null;
				for(let i=0; i<a.length; i++) {
					let currDate = new Date(a[i].date.replace(' ', 'T'));
					let prevDate = (i == 0) ? null : new Date(a[i-1].date.replace(' ', 'T'));
					currDate = this.SetNullDate(currDate);
					prevDate = (prevDate == null) ? null : this.SetNullDate(prevDate);
					if ((prevDate == null) || (prevDate.getTime() != currDate.getTime())) {
						b.push({ sep: true, date: currDate });
						b.push(a[i]);
					}
					else b.push(a[i]);
				}
				return b;
			}
		},
        data: function () {
			let titickets = this.GetTickets(this.$root.tickets);
            return {
                products: this.$root.products,
				tickets: titickets//this.$root.tickets
            };
        },
    };
</script>